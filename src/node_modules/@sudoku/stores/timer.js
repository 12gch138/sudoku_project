import { readable, writable, get } from 'svelte/store';

export const timerRunning = writable(false);

function createTimer() {
	let startTime;
	let elapsedTime = 0;
	let timerInterval;

	const { subscribe } = readable(0, start);

	function reset() {
		clearInterval(timerInterval);
		elapsedTime = 0;
		timerRunning.set(false);
	}

	function start(set) {
		startTime = Date.now() - get({ subscribe });
		timerRunning.set(true);

		timerInterval = setInterval(() => {
			elapsedTime = Date.now() - startTime;
			set(elapsedTime);
		}, 1000);

		return reset;
	}

	function pause() {
		clearInterval(timerInterval);
		timerRunning.set(false);
	}

	return {
		subscribe,
		start,
		pause,
		reset
	};
}

export const timer = createTimer();