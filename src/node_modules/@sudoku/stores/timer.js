import { writable, get } from 'svelte/store';

export const timerRunning = writable(false);

function createTimer() {
	let startTime;
	let timerInterval;

	const elapsedTime = writable(0);

	// The timer uses a writable store but only returns a subscribe function so it's read-only
	return {
		subscribe: elapsedTime.subscribe,

		start: () => {
			startTime = Date.now() - get(elapsedTime);
			timerRunning.set(true);

			timerInterval = setInterval(() => {
				elapsedTime.set(Date.now() - startTime);
			}, 1000);
		},

		pause: () => {
			clearInterval(timerInterval);
			timerRunning.set(false);
		},

		reset: () => {
			clearInterval(timerInterval);
			elapsedTime.set(0);
			timerRunning.set(false);
		},
	};
}

export const timer = createTimer();